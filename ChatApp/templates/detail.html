{% extends 'base.html' %} {% block title %}
<title>{{ channel.name }}</title>
{% endblock %} {% block body %}
<div class="main-container">
  <div class="chat-box">
    <div id="chat-header">
      <p id="chatroom-name">{{ channel.name }}</p>
      {% if channel.abstract is not none %}
      <p id="chatroom-description">{{ channel.abstract }}</p>
      {% endif %} 
      {% if uid == channel.uid %}
      <button id="channel-update-button">
        <i class="fa-solid fa-pen-to-square fa-lg"></i>
      </button>
      {% include 'modal/update-channel.html' %} {% endif %}
      <button id="to-index-button">
        <a class="fas fa-home" href="{{ url_for('index') }}"></a>
      </button>
    </div>
    <div class="pinned-message-area">
      {% if message.pinned is not none %}
      <div class="pinned-message-area">
        <p id="pinned-message">{{ message.pinned }}</p>
      </div>
      {% endif %} 
    </div>
    <div id="message-area">
      {% if messages|length > 0 %} 
        {% for message in messages %} 
          {% if message.uid == uid %}
            <div class="my-messages">
              <div class="message-options">
                <p class="my-user-name">{{ message.user_name }}</p>
                <div class="option-icons">
                  {% if uid == uid %}
                    <form action="/pin_message" method="POST">
                      <input type="hidden" value="{{ channel.id }}" name="cid" />
                      <button 
                        class="pinned-message-button" 
                        name="message_id" 
                        value="{{ message.id }}"
                      >
                        <i class="fas fa-thumbtack fa-rotate-45"></i>
                      </button>
                    </form>
                  {% endif %} 
                  <form action="/delete_message" method="POST">
                    <input type="hidden" value="{{ channel.id }}" name="cid" />
                    <button 
                      class="delete-message-button" 
                      name="message_id" 
                      value="{{ message.id }}"
                    >
                      <i class="far fa-trash-alt"></i>
                    </button>
                  </form>
                </div>
              </div>
              <p class="box box-right">{{ message.message }}</p>
              <div class="reaction-container reaction-container-right">
                {% if message.reactioncount > 0 %}
                  <p>
                    <i class="fas fa-smile"></i>
                    {{ reactioncount }}
                  </p>
                {% endif %}
                <form action="/reaction_message" method="POST">
                  <input type="hidden" value="{{ channel.id }}" name="cid" />
                  <button 
                    class="reaction-button" 
                    name="message_id" 
                    value="{{ message.id }}"
                  >
                    <i class=" far fa-smile "></i>
                  </button>
                </form>
              </div>
            </div>
          {% else %}
            <div class="messages">
              <p class="user-name">{{ message.user_name }}</p>
              <p class="box box-left">{{ message.message }}</p>
              <div class="reaction-container reaction-container-left">
                {% if message.reactioncount > 0 %}
                  <p>
                    <i class="fas fa-smile"></i>
                    {{ reactioncount }}
                  </p>
                {% endif %}
                <form action="/reaction_message" method="POST">
                  <input type="hidden" value="{{ channel.id }}" name="cid" />
                  <button 
                    class="reaction-button" 
                    name="message_id" 
                    value="{{ message.id }}"
                  >
                    <i class=" far fa-smile "></i>
                  </button>
                </form>
              </div>
            </div>
          {% endif %} 
        {% endfor %} 
      {% else %}
        <div id="no-message"><p>まだメッセージがありません</p></div>
      {% endif %}
    </div>
    <div class="typing-box-wrapper">
      <form 
        class="typing-box" 
        action="/message" 
        method="POST" 
        name="newMessageForm"
      >
        <textarea name="message" id="message" autofocus></textarea>
        <input type="hidden" name="cid" value="{{ channel.id }}" />
        <div id="message-send-tooltip">
          <button type="submit" id="add-message-button">
            <i class="fas fa-paper-plane"></i>
          </button>
          </div>
        </div>
      </form>
    </div>
</div>
{% endblock %}{% block script %}
<script type="text/javascript">
  // prettier-ignore
  const uid = JSON.parse('{{ uid|tojson }}');
</script>
<script
  src="{{url_for('static',filename='js/Channels/update-channel.js')}}"
  type="text/javascript"
></script>

<script
  src="{{url_for('static',filename='js/scroll-message.js')}}"
  type="text/javascript"
></script>
{% endblock %}
